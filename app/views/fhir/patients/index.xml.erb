<?xml version="1.0" encoding="UTF-8"?>

<document>
  <% @patients.each do |client| %>
    <Patient xmlns="http://hl7.org/fhir">
      <text>
      <% unless client.text.status.nil? %>
        <status value="<%= client.text.status[:value] %>"/>
      <% end %>
      <% unless client.text.div.nil? %>
        <div xmlns="http://www.w3.org/1999/xhtml"><%= client.text.div.html_safe %></div>
      <% end %>
      </text>
      <active value="<%= client.active %>"/>
      <% client.identifiers.each do |identifier| -%>
      <identifier>
        <% unless identifier.label.nil? %>
        <label value="<%= identifier.label %>"/>
        <% end %>
        <% unless identifier.system.nil? %>
        <system value="<%= identifier.system %>"/>
        <% end %>
        <% unless identifier.id.nil? %>
        <id value="<%= identifier.id %>"/>
        <% end %>
        <% unless identifier.assigner.nil? %>
        <assigner value="<%= identifier.assigner %>"/>
        <% end %>
        <% unless identifier.use.nil? %>
        <use value="<%= identifier.use %>"/>
        <% end %>
        <% unless identifier.period.nil? %>     <!--TODO: Need to test, examples are incomplete -->
        <period value="<%= identifier.period %>"/>
        <% end %>
      </identifier>
      <% end unless client.identifiers.nil? %>
      <% client.names.each do |name| -%>
      <name>
        <% unless name.use.nil? %>
        <use value="<%= name.use[:value] %>"/>
        <% end %>
        <% unless name.text.nil? %>
        <text value="<%= name.text[:value] %>"/>
        <% end %>
        <% name.family.each do |rel| %>
        <family value="<%= rel[:value] %>"/>
        <% end unless name.family.nil? %>
        <% name.given.each do |sir| %>
        <given value="<%= sir[:value] %>"/>
        <% end unless name.given.nil? %>
        <% name.prefix.each do |pre| %>         <!--TODO: Need to test, examples are incomplete -->
        <prefix value="<%= pre %>"/>
        <% end unless name.prefix.nil? %>
        <% name.suffix.each do |suf| %>         <!--TODO: Need to test, examples are incomplete -->
        <suffix value="<%= suf %>"/>
        <% end unless name.suffix.nil? %>
        <% unless name.period.nil? %>           <!--TODO: Need to test, examples are incomplete -->
        <period value="<%= name.period[:value] %>"/>
        <% end %>
      </name>
      <% end unless client.names.nil? %>
      <% client.telecoms.each do |telecom| -%>
      <telecom>
        <% unless telecom.system.nil? %>
        <system value="<%= telecom.system %>"/>
        <% end %>
        <% unless telecom.value.nil? %>
        <value value="<%= telecom.value %>"/>
        <% end %>
        <% unless telecom.use.nil? %>
        <use value="<%= telecom.use %>"/>
        <% end %>
        <% unless telecom.period.nil? %>
        <period value="<% telecom.period %>"/>
        <% end %>
      </telecom>
      <% end unless client.telecoms.nil? %>
      <% unless client.gender.nil? %>
      <gender>
        <% unless client.gender.code.nil? %>
        <code value="<%= client.gender.code %>"/>
        <% end %>
        <% unless client.gender.display.nil? %>
        <display value="<%= client.gender.display %>"/>
        <% end %>
        <% unless client.gender.system.nil? %>
        <system value="<%= client.gender.system %>"/>
        <% end %>
      </gender>
      <% end %>
      <% client.addresses.each do |address| %>
      <address>
        <% unless address.use.nil? %>
        <use value="<%= address.use[:value] %>"/>
        <% end %>
        <% unless address.text.nil? %>
        <text value="<%= address.text %>"/>
        <% end %>
        <% address.line.each do |ln| %>
        <line value="<%= ln[1].to_s %>"/>
        <% end unless address.line.nil? %>
        <% unless address.city.nil? %>
        <city value="<%= address.city[:value] %>"/>
        <% end %>
        <% unless address.state.nil? %>
        <state value="<%= address.state[:value] %>"/>
        <% end %>
        <% unless address.zip.nil? %>
        <zip value="<%= address.zip[:value] %>"/>
        <% end %>
        <% unless address.country.nil? %>
        <country value="<%= address.country[:value] %>"/>
        <% end %>
        <% unless address.period.nil? %>
        <period value="<%= address.period[:value] %>"/>
        <% end %>
      </address>
      <% end unless client.addresses.nil? %>
      <% unless client.provider.nil? %>
      <provider>
        <% unless client.provider.type.nil? %>
        <type value="<%= client.provider.type[:value] %>"/>
        <% end %>
        <% unless client.provider.url.nil? %>
        <url value="<%= client.provider.url[:value] %>"/>
        <% end %>
      </provider>
      <% end %>
    </Patient>
  <% end %>
</document>
